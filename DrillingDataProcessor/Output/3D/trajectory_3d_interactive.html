
<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>钻孔轨迹三维可视化</title>
    <script src='https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js'></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: Arial, sans-serif; background: #000; }
        #container { width: 100vw; height: 100vh; position: relative; }
        #info { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
        #controls { position: absolute; top: 10px; right: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
        button { margin: 2px; padding: 5px 10px; background: #444; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #666; }
        button.active { background: #0a84ff; }
    </style>
</head>
<body>
    <div id='container'>
        <div id='info'>
            <h3>钻孔轨迹三维可视化</h3>
            <p>轨迹点数: <span id='pointCount'>0</span></p>
            <p>深度范围: <span id='depthRange'>0</span></p>
            <p>当前视角: <span id='viewInfo'>默认</span></p>
        </div>
        <div id='controls'>
            <button onclick='resetView()'>重置视角</button><br>
            <button onclick='togglePoints()' id='pointsBtn' class='active'>显示点</button><br>
            <button onclick='toggleLines()' id='linesBtn' class='active'>显示线</button><br>
            <button onclick='toggleAxis()' id='axisBtn' class='active'>显示坐标轴</button><br>
            <button onclick='changeColorScheme()' id='colorBtn'>深度着色</button><br>
            <button onclick='exportView()'>导出视图</button>
        </div>
    </div>

    <script>
        // 数据注入点
        const trajectoryPoints = [{"x":0,"y":0,"z":-0},{"x":1.2431813,"y":-0.054169677,"z":-1.2443609},{"x":2.4590437,"y":-0.34225973,"z":-2.4938877},{"x":3.6838088,"y":-0.62828577,"z":-3.7516081},{"x":4.9188657,"y":-0.91773844,"z":-5.02013},{"x":6.1614394,"y":-1.2127303,"z":-6.2972403},{"x":7.411142,"y":-1.5083779,"z":-7.581438},{"x":8.662022,"y":-1.8216488,"z":-8.870949},{"x":9.910953,"y":-2.149766,"z":-10.162262},{"x":11.166589,"y":-2.4850383,"z":-11.461888},{"x":12.443582,"y":-2.7950373,"z":-12.7759695},{"x":13.742507,"y":-3.0626137,"z":-14.102169},{"x":15.053563,"y":-3.3175762,"z":-15.437786},{"x":15.176794,"y":-4.657404,"z":-16.783268},{"x":15.31662,"y":-6.004721,"z":-18.137821},{"x":16.65779,"y":-6.2500253,"z":-19.50124},{"x":18.002205,"y":-6.5024757,"z":-20.869152},{"x":19.351452,"y":-6.7350464,"z":-22.238297},{"x":20.706652,"y":-6.9623156,"z":-23.612421},{"x":22.068222,"y":-7.2004375,"z":-24.994658},{"x":23.439283,"y":-7.4317203,"z":-26.38509},{"x":24.821474,"y":-7.6363173,"z":-27.782341},{"x":26.211048,"y":-7.839282,"z":-29.18666},{"x":27.608421,"y":-8.038158,"z":-30.598114},{"x":29.014938,"y":-8.229452,"z":-32.017582},{"x":30.430414,"y":-8.415677,"z":-33.445255},{"x":31.849083,"y":-8.604086,"z":-34.87638},{"x":33.268654,"y":-8.809408,"z":-36.310722},{"x":34.696632,"y":-8.997912,"z":-37.75109},{"x":36.131466,"y":-9.161645,"z":-39.195236},{"x":37.56637,"y":-9.343552,"z":-40.64162},{"x":39.006817,"y":-9.511746,"z":-42.091854},{"x":40.452286,"y":-9.666095,"z":-43.54554},{"x":41.901665,"y":-9.815362,"z":-45.002583},{"x":43.357742,"y":-9.941088,"z":-46.464077},{"x":44.817364,"y":-10.083048,"z":-47.930588},{"x":46.281498,"y":-10.217583,"z":-49.40089},{"x":47.75036,"y":-10.323001,"z":-50.87353},{"x":49.220108,"y":-10.441255,"z":-52.34803}];
        const colors = [0,0.02631579,0.05263158,0.078947365,0.10526316,0.13157895,0.15789473,0.18421052,0.21052632,0.23684211,0.2631579,0.28947368,0.31578946,0.34210527,0.36842105,0.39473686,0.42105263,0.4473684,0.47368422,0.5,0.5263158,0.55263156,0.57894737,0.6052632,0.6315789,0.65789473,0.68421054,0.7105263,0.7368421,0.7631579,0.7894737,0.81578946,0.84210527,0.8684211,0.8947368,0.92105263,0.94736844,0.9736842,1];
        const labels = ["\u70B91: \u6DF1\u5EA60.0m, \u503E\u89D234.0\u00B0, \u65B9\u4F4D81.5\u00B0","\u70B92: \u6DF1\u5EA61.5m, \u503E\u89D233.8\u00B0, \u65B9\u4F4D103.5\u00B0","\u70B93: \u6DF1\u5EA63.0m, \u503E\u89D233.3\u00B0, \u65B9\u4F4D103.2\u00B0","\u70B94: \u6DF1\u5EA64.5m, \u503E\u89D232.7\u00B0, \u65B9\u4F4D103.1\u00B0","\u70B95: \u6DF1\u5EA66.0m, \u503E\u89D231.8\u00B0, \u65B9\u4F4D103.3\u00B0","\u70B96: \u6DF1\u5EA67.5m, \u503E\u89D231.5\u00B0, \u65B9\u4F4D103.4\u00B0","\u70B97: \u6DF1\u5EA69.0m, \u503E\u89D230.8\u00B0, \u65B9\u4F4D103.2\u00B0","\u70B98: \u6DF1\u5EA610.5m, \u503E\u89D230.7\u00B0, \u65B9\u4F4D104.9\u00B0","\u70B99: \u6DF1\u5EA612.0m, \u503E\u89D230.5\u00B0, \u65B9\u4F4D104.5\u00B0","\u70B910: \u6DF1\u5EA613.5m, \u503E\u89D229.4\u00B0, \u65B9\u4F4D105.4\u00B0","\u70B911: \u6DF1\u5EA615.0m, \u503E\u89D228.2\u00B0, \u65B9\u4F4D101.9\u00B0","\u70B912: \u6DF1\u5EA616.5m, \u503E\u89D227.5\u00B0, \u65B9\u4F4D101.4\u00B0","\u70B913: \u6DF1\u5EA618.0m, \u503E\u89D226.7\u00B0, \u65B9\u4F4D100.6\u00B0","\u70B914: \u6DF1\u5EA619.5m, \u503E\u89D225.8\u00B0, \u65B9\u4F4D248.9\u00B0","\u70B915: \u6DF1\u5EA621.0m, \u503E\u89D225.1\u00B0, \u65B9\u4F4D99.3\u00B0","\u70B916: \u6DF1\u5EA622.5m, \u503E\u89D224.2\u00B0, \u65B9\u4F4D101.4\u00B0","\u70B917: \u6DF1\u5EA624.0m, \u503E\u89D224.3\u00B0, \u65B9\u4F4D99.8\u00B0","\u70B918: \u6DF1\u5EA625.5m, \u503E\u89D224.0\u00B0, \u65B9\u4F4D99.7\u00B0","\u70B919: \u6DF1\u5EA627.0m, \u503E\u89D223.3\u00B0, \u65B9\u4F4D99.3\u00B0","\u70B920: \u6DF1\u5EA628.5m, \u503E\u89D222.4\u00B0, \u65B9\u4F4D100.5\u00B0","\u70B921: \u6DF1\u5EA630.0m, \u503E\u89D221.7\u00B0, \u65B9\u4F4D98.6\u00B0","\u70B922: \u6DF1\u5EA631.5m, \u503E\u89D221.0\u00B0, \u65B9\u4F4D98.2\u00B0","\u70B923: \u6DF1\u5EA633.0m, \u503E\u89D220.2\u00B0, \u65B9\u4F4D98.4\u00B0","\u70B924: \u6DF1\u5EA634.5m, \u503E\u89D219.4\u00B0, \u65B9\u4F4D97.8\u00B0","\u70B925: \u6DF1\u5EA636.0m, \u503E\u89D218.3\u00B0, \u65B9\u4F4D97.7\u00B0","\u70B926: \u6DF1\u5EA637.5m, \u503E\u89D217.4\u00B0, \u65B9\u4F4D97.3\u00B0","\u70B927: \u6DF1\u5EA639.0m, \u503E\u89D217.5\u00B0, \u65B9\u4F4D97.8\u00B0","\u70B928: \u6DF1\u5EA640.5m, \u503E\u89D216.6\u00B0, \u65B9\u4F4D98.6\u00B0","\u70B929: \u6DF1\u5EA642.0m, \u503E\u89D215.8\u00B0, \u65B9\u4F4D96.4\u00B0","\u70B930: \u6DF1\u5EA643.5m, \u503E\u89D215.5\u00B0, \u65B9\u4F4D96.6\u00B0","\u70B931: \u6DF1\u5EA645.0m, \u503E\u89D215.2\u00B0, \u65B9\u4F4D97.8\u00B0","\u70B932: \u6DF1\u5EA646.5m, \u503E\u89D214.4\u00B0, \u65B9\u4F4D95.5\u00B0","\u70B933: \u6DF1\u5EA648.0m, \u503E\u89D214.1\u00B0, \u65B9\u4F4D96.7\u00B0","\u70B934: \u6DF1\u5EA649.5m, \u503E\u89D213.3\u00B0, \u65B9\u4F4D95.0\u00B0","\u70B935: \u6DF1\u5EA651.0m, \u503E\u89D212.7\u00B0, \u65B9\u4F4D94.8\u00B0","\u70B936: \u6DF1\u5EA652.5m, \u503E\u89D211.6\u00B0, \u65B9\u4F4D96.3\u00B0","\u70B937: \u6DF1\u5EA654.0m, \u503E\u89D211.3\u00B0, \u65B9\u4F4D94.2\u00B0","\u70B938: \u6DF1\u5EA655.5m, \u503E\u89D210.7\u00B0, \u65B9\u4F4D94.0\u00B0","\u70B939: \u6DF1\u5EA657.0m, \u503E\u89D210.5\u00B0, \u65B9\u4F4D95.2\u00B0"];
        const bounds = {"min":{"x":0,"y":-10.441255,"z":-52.34803},"max":{"x":49.220108,"y":0,"z":-0}};
        
        // Three.js 场景设置
        let scene, camera, renderer, controls;
        let trajectoryLine, trajectoryPointsMesh, coordinateAxes;
        let currentColorScheme = 'depth';
        
        function init() {
            // 创建场景
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            // 创建相机
            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 10000);
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // 创建控制器
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // 添加光照
            addLighting();
            
            // 创建轨迹
            createTrajectory();
            
            // 创建坐标轴
            createCoordinateAxes();
            
            // 设置相机位置
            resetView();
            
            // 更新界面信息
            updateInfo();
            
            // 开始渲染循环
            animate();
        }
        
        function addLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
        }
        
        function createTrajectory() {
            // 创建轨迹线
            const lineGeometry = new THREE.BufferGeometry();
            const linePositions = new Float32Array(trajectoryPoints.length * 3);
            const lineColors = new Float32Array(trajectoryPoints.length * 3);
            
            for (let i = 0; i < trajectoryPoints.length; i++) {
                const point = trajectoryPoints[i];
                linePositions[i * 3] = point.x;
                linePositions[i * 3 + 1] = point.y;
                linePositions[i * 3 + 2] = point.z;
                
                const color = getColorFromValue(colors[i] || 0);
                lineColors[i * 3] = color.r;
                lineColors[i * 3 + 1] = color.g;
                lineColors[i * 3 + 2] = color.b;
            }
            
            lineGeometry.setAttribute('position', new THREE.BufferAttribute(linePositions, 3));
            lineGeometry.setAttribute('color', new THREE.BufferAttribute(lineColors, 3));
            
            const lineMaterial = new THREE.LineBasicMaterial({ 
                vertexColors: true, 
                linewidth: 2 
            });
            
            trajectoryLine = new THREE.Line(lineGeometry, lineMaterial);
            scene.add(trajectoryLine);
            
            // 创建轨迹点
            const pointGeometry = new THREE.BufferGeometry();
            pointGeometry.setAttribute('position', new THREE.BufferAttribute(linePositions, 3));
            pointGeometry.setAttribute('color', new THREE.BufferAttribute(lineColors, 3));
            
            const pointMaterial = new THREE.PointsMaterial({ 
                vertexColors: true, 
                size: 5 
            });
            
            trajectoryPointsMesh = new THREE.Points(pointGeometry, pointMaterial);
            scene.add(trajectoryPointsMesh);
        }
        
        function createCoordinateAxes() {
            coordinateAxes = new THREE.Group();
            
            // X轴 - 红色
            const xGeometry = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(100, 0, 0)
            ]);
            const xMaterial = new THREE.LineBasicMaterial({ color: 0xff0000 });
            const xAxis = new THREE.Line(xGeometry, xMaterial);
            coordinateAxes.add(xAxis);
            
            // Y轴 - 绿色
            const yGeometry = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(0, 100, 0)
            ]);
            const yMaterial = new THREE.LineBasicMaterial({ color: 0x00ff00 });
            const yAxis = new THREE.Line(yGeometry, yMaterial);
            coordinateAxes.add(yAxis);
            
            // Z轴 - 蓝色
            const zGeometry = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(0, 0, 100)
            ]);
            const zMaterial = new THREE.LineBasicMaterial({ color: 0x0000ff });
            const zAxis = new THREE.Line(zGeometry, zMaterial);
            coordinateAxes.add(zAxis);
            
            scene.add(coordinateAxes);
        }
        
        function getColorFromValue(value) {
            // 彩虹色谱映射
            const hue = (1 - value) * 240 / 360; // 从红到蓝
            const color = new THREE.Color().setHSL(hue, 1, 0.5);
            return color;
        }
        
        function resetView() {
            const center = bounds ? {
                x: (bounds.min.x + bounds.max.x) / 2,
                y: (bounds.min.y + bounds.max.y) / 2,
                z: (bounds.min.z + bounds.max.z) / 2
            } : { x: 0, y: 0, z: 0 };
            
            const size = bounds ? Math.max(
                bounds.max.x - bounds.min.x,
                bounds.max.y - bounds.min.y,
                bounds.max.z - bounds.min.z
            ) : 100;
            
            camera.position.set(center.x + size, center.y + size, center.z + size);
            controls.target.set(center.x, center.y, center.z);
            controls.update();
            
            document.getElementById('viewInfo').textContent = '俯视视角';
        }
        
        function togglePoints() {
            trajectoryPointsMesh.visible = !trajectoryPointsMesh.visible;
            const btn = document.getElementById('pointsBtn');
            btn.classList.toggle('active');
            btn.textContent = trajectoryPointsMesh.visible ? '隐藏点' : '显示点';
        }
        
        function toggleLines() {
            trajectoryLine.visible = !trajectoryLine.visible;
            const btn = document.getElementById('linesBtn');
            btn.classList.toggle('active');
            btn.textContent = trajectoryLine.visible ? '隐藏线' : '显示线';
        }
        
        function toggleAxis() {
            coordinateAxes.visible = !coordinateAxes.visible;
            const btn = document.getElementById('axisBtn');
            btn.classList.toggle('active');
            btn.textContent = coordinateAxes.visible ? '隐藏坐标轴' : '显示坐标轴';
        }
        
        function changeColorScheme() {
            const schemes = ['depth', 'inclination', 'azimuth'];
            const currentIndex = schemes.indexOf(currentColorScheme);
            currentColorScheme = schemes[(currentIndex + 1) % schemes.length];
            
            const schemeNames = { depth: '深度着色', inclination: '倾角着色', azimuth: '方位着色' };
            document.getElementById('colorBtn').textContent = schemeNames[currentColorScheme];
            
            // 重新创建轨迹以应用新的颜色方案
            scene.remove(trajectoryLine);
            scene.remove(trajectoryPointsMesh);
            createTrajectory();
        }
        
        function exportView() {
            const link = document.createElement('a');
            link.download = 'trajectory_view.png';
            link.href = renderer.domElement.toDataURL();
            link.click();
        }
        
        function updateInfo() {
            document.getElementById('pointCount').textContent = trajectoryPoints.length;
            if (bounds) {
                const depthRange = `${bounds.min.z.toFixed(1)}m 到 ${bounds.max.z.toFixed(1)}m`;
                document.getElementById('depthRange').textContent = depthRange;
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize);
        
        // 初始化
        init();
    </script>
</body>
</html>